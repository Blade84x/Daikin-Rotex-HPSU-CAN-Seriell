name: Manually Triggered Workflow with Checkboxes

on:
  workflow_dispatch:
    inputs:
      param1:
        description: 'Parameter 1'
        required: true
        default: 'default_value'
      param2:
        description: 'Parameter 2'
        required: false
        default: 'optional_value'
      checkbox1:
        description: 'Checkbox 1'
        required: true
        type: boolean
        default: false
      checkbox2:
        description: 'Checkbox 2'
        required: false
        type: boolean
        default: false

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'

    - name: Install cells into venv
      run: |
        pip install cells
        env | grep -i python
        ls -alh /opt/hostedtoolcache/Python/3.12.7/x64/bin
        find / -name 'cels'
        cels version

    - name: Run a script
      run: |
        echo "Running a script with param1=${{ github.event.inputs.param1 }} and param2=${{ github.event.inputs.param2 }}"
        if ${{ github.event.inputs.checkbox1 }}; then
          echo "Checkbox 1 is checked"
        else
          echo "Checkbox 1 is not checked"
        fi
        if ${{ github.event.inputs.checkbox2 }}; then
          echo "Checkbox 2 is checked"
        else
          echo "Checkbox 2 is not checked"
        fi
        cp .github/workflows/resources/extract_block_test.py .
        cp examples/full.yaml .

        # patch full.yaml to load external components from dev
        if [ "${{ github.ref }}" == "refs/heads/dev" ]; then 
          echo "This step runs only on the dev branch"            
          cp .github/workflows/resources/external_components_dev.yaml .
          sed -i 's/!/?/g' full.yaml # make yaml pyyaml conform
          cels patch full.yaml external_components_dev.yaml
          sed -i 's/?/!/g' full.yaml # make yaml esphome conform
        else 
          echo "This step does not run on the dev branch" 
        fi

        # print path used for external components
        python extract_block_test.py
